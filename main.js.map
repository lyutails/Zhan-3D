{"version":3,"file":"main.js","mappings":"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","sources":["webpack://my-webpack-project/./src/3d.ts"],"sourcesContent":["import './index.scss'\r\n\r\nclass Vector{\r\n    x: number;\r\n    y: number; \r\n    constructor(x: number, y: number){\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n    add(vector: Vector){\r\n        this.x += vector.x;\r\n        this.y += vector.y;\r\n        return this;\r\n    }\r\n    scale(multiplier: number){\r\n        this.x *= multiplier;\r\n        this.y *= multiplier;\r\n        return this;\r\n    }\r\n    abs(): number{\r\n        return Math.hypot(this.x, this.y);\r\n    }\r\n    clone(): Vector{\r\n        return new Vector(this.x, this.y);\r\n    }    \r\n};\r\n\r\nclass Main{\r\n    private lastAnimation: number = null;\r\n    private context: CanvasRenderingContext2D;\r\n    private angle: number = 0;\r\n    vbuffer: DOMPoint[];\r\n    ibuffer: number[];\r\n    points: {pos: DOMPoint, angle: number}[]=[];\r\n    rot: DOMPoint = new DOMPoint();\r\n    keys: Record<string, boolean>;\r\n    position: DOMPoint = new DOMPoint();\r\n    constructor(parent: HTMLElement){        \r\n        const keys: Record<string, boolean> = {};\r\n        document.onkeyup = (e) => {\r\n            keys [e.code] = false;\r\n        }\r\n        document.onkeydown = (e) => {\r\n            keys [e.code] = true;\r\n        }\r\n        this.keys = keys;        \r\n        for (let i=0; i<10; i+=1){\r\n            const random = new DOMPoint(Math.random()*10-5, Math.random()*10-5, Math.random()*10+5);\r\n            this.points.push({pos: random, angle: 0});\r\n        }\r\n        const canvas = document.createElement('canvas');\r\n        canvas.onmousemove = (e) => {\r\n            this.rot.x += e.movementX*0.01\r\n            this.rot.y += e.movementY*0.01\r\n        };\r\n        canvas.width = (2500);\r\n        canvas.height = (1200);        \r\n        const context = canvas.getContext('2d');\r\n        this.context = context;\r\n        parent.append(canvas);\r\n        context.fillStyle = ('#c7375c');\r\n        context.strokeStyle = ('#ffffff');\r\n        context.lineWidth = 3;\r\n        context.fillRect(0, 0, canvas.width, canvas.height);\r\n        const vbuffer = [\r\n            new DOMPoint (-1, -1, -1, 1),\r\n            new DOMPoint (1, -1, -1, 1),\r\n            new DOMPoint (1, 1, -1, 1),\r\n            new DOMPoint (-1, 1, -1, 1),\r\n            new DOMPoint (-1, -1, 1, 1),\r\n            new DOMPoint (1, -1, 1, 1),\r\n            new DOMPoint (1, 1, 1, 1),\r\n            new DOMPoint (-1, 1, 1, 1),            \r\n        ];\r\n        const ibuffer = [\r\n            0, 1, 2,\r\n            0, 2, 3, \r\n            4, 5, 6,\r\n            4, 6, 7,            \r\n            1, 5, 6,\r\n            6, 2, 1,\r\n            0, 4, 7,\r\n            0, 3, 7,\r\n            3, 7, 6,\r\n            6, 2, 3,         \r\n            0, 4, 5,\r\n            5, 1, 0,\r\n        ];\r\n        this.vbuffer = vbuffer;\r\n        this.ibuffer = ibuffer;\r\n    }\r\n\r\n    private handleKey(){\r\n        const direction = new DOMPoint();\r\n        if (this.keys[\"KeyW\"]){\r\n            direction.y += 0.1;\r\n        }\r\n        if (this.keys[\"KeyA\"]){\r\n            direction.x += 0.1;\r\n        }\r\n        if (this.keys[\"KeyS\"]){\r\n            direction.y -= 0.1;\r\n        }\r\n        if (this.keys[\"KeyD\"]){\r\n            direction.x -= 0.1;\r\n        }\r\n        this.position.x += direction.x;\r\n        this.position.y += direction.y;\r\n    }\r\n\r\n    private cube(projection: DOMMatrix, position: DOMPoint, angle: number){\r\n        const context = this.context;\r\n        const matrix = new DOMMatrix().         \r\n        translate(position.x, position.y, position.z).rotate(angle, angle, 0);        \r\n        //this.angle += 1;\r\n        const vbuffer = this.vbuffer.map(v => {            \r\n            return this.transform(projection, matrix, v);\r\n        })          \r\n        \r\n        for (let i=0; i<this.ibuffer.length; i+=3) {\r\n            const i1 = this.ibuffer[i];\r\n            const i2 = this.ibuffer[i+1];\r\n            const i3 = this.ibuffer[i+2];\r\n            context.beginPath();       \r\n            context.moveTo(vbuffer [i1].x, vbuffer [i1].y);            \r\n            context.lineTo(vbuffer [i2].x, vbuffer [i2].y);\r\n            context.lineTo(vbuffer [i3].x, vbuffer [i3].y);\r\n            context.lineTo(vbuffer [i1].x, vbuffer [i1].y);\r\n            context.stroke();\r\n            context.closePath();  \r\n        };                \r\n    }\r\n\r\n    private transform(projection: DOMMatrix, matrix: DOMMatrix, vector: DOMPoint) {\r\n        const context = this.context;\r\n        const canvas = this.context.canvas;\r\n        const result = projection.multiply(matrix).transformPoint(vector);\r\n            return new DOMPoint(\r\n                (((result.x/result.w)*0.5)+0.5)*canvas.width,\r\n                ((result.y/result.w)*(-0.5)+0.5)*canvas.height\r\n            );\r\n    }\r\n\r\n        private render(){\r\n            this.handleKey();        \r\n            const context = this.context;\r\n            const canvas = this.context.canvas;\r\n            const center = new Vector(canvas.width / 2, canvas.height /2);\r\n            context.fillRect(0, 0, canvas.width, canvas.height); \r\n            const projection = perspective(Math.PI/2, canvas.width/canvas.height, 1, 1000);\r\n            const camera = new DOMMatrix().translate(this.position.x, 0, this.position.y).rotate(this.rot.y, this.rot.x);\r\n            this.points.forEach((cube, i) => {\r\n                cube.angle += (i*0.1);\r\n                this.cube(projection.multiply(camera), cube.pos, cube. angle);\r\n            });       \r\n            this.lastAnimation = requestAnimationFrame(() => {\r\n                this.render();\r\n        });\r\n        canvas.toDataURL();                        \r\n    }  \r\n    start(){\r\n        this.render();\r\n    }  \r\n    stop(){\r\n        cancelAnimationFrame(this.lastAnimation);\r\n    }       \r\n};\r\n\r\nconst main = new Main(document.body);\r\n\r\nfunction buttonCreate(onClick: () => void): HTMLElement{\r\n    const button = document.createElement('button');\r\n    button.textContent = 'move me WASD 3D';\r\n    button.className = 'rotate_button';\r\n    button.onclick = () => {\r\n        onClick();        \r\n    }\r\n    return button;    \r\n}\r\nfunction addButton(start: boolean){\r\n    const button = buttonCreate(() => {\r\n        if (start){\r\n            main.start();\r\n        } else {\r\n            main.stop();\r\n        }\r\n        button.remove();\r\n        addButton(!start);\r\n    })\r\n    document.body.append(button);\r\n};\r\naddButton(true);\r\n\r\n\r\nfunction perspective(fieldOfViewInRadians: number, aspect: number, near: number, far: number) {\r\n    const dst = [];\r\n    var f = Math.tan(Math.PI * 0.5 - 0.5 * fieldOfViewInRadians);\r\n    var rangeInv = 1.0 / (near - far);\r\n\r\n    dst[ 0] = f / aspect;\r\n    dst[ 1] = 0;\r\n    dst[ 2] = 0;\r\n    dst[ 3] = 0;\r\n    dst[ 4] = 0;\r\n    dst[ 5] = f;\r\n    dst[ 6] = 0;\r\n    dst[ 7] = 0;\r\n    dst[ 8] = 0;\r\n    dst[ 9] = 0;\r\n    dst[10] = (near + far) * rangeInv;\r\n    dst[11] = -1;\r\n    dst[12] = 0;\r\n    dst[13] = 0;\r\n    dst[14] = near * far * rangeInv * 2;\r\n    dst[15] = 0;\r\n\r\n    return new DOMMatrix(dst);\r\n  }\r\n"],"names":["x","y","this","add","vector","scale","multiplier","abs","Math","hypot","clone","Vector","main","parent","lastAnimation","angle","points","rot","DOMPoint","position","keys","document","onkeyup","e","code","onkeydown","i","random","push","pos","canvas","createElement","onmousemove","movementX","movementY","width","height","context","getContext","append","fillStyle","strokeStyle","lineWidth","fillRect","vbuffer","ibuffer","handleKey","direction","cube","projection","matrix","DOMMatrix","translate","z","rotate","map","v","transform","length","i1","i2","i3","beginPath","moveTo","lineTo","stroke","closePath","result","multiply","transformPoint","w","render","fieldOfViewInRadians","aspect","dst","f","rangeInv","PI","tan","near","camera","forEach","requestAnimationFrame","toDataURL","start","stop","cancelAnimationFrame","body","addButton","button","onClick","textContent","className","onclick","buttonCreate","remove"],"sourceRoot":""}